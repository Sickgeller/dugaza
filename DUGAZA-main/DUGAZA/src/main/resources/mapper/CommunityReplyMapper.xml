<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.spring.community.dao.CommunityReplyMapper">

	<resultMap id="replyMap"
		type="kr.spring.community.vo.CommunityReplyVO">
		<id property="replyId" column="reply_id" />
		<result property="postId" column="post_id" />
		<result property="memberId" column="member_id" />
		<result property="content" column="content" />
		<result property="regdate" column="regdate" />
	</resultMap>

	<select id="selectReplyList" parameterType="long"
		resultMap="replyMap">
		SELECT *
		FROM COMMUNITY_REPLY
		WHERE POST_ID = #{postId}
		ORDER BY REGDATE ASC
	</select>
	
	<select id="getReply" parameterType="long" resultMap="replyMap">
        SELECT * FROM COMMUNITY_REPLY WHERE REPLY_ID = #{replyId}
    </select>

	<insert id="insertReply"
		parameterType="kr.spring.community.vo.CommunityReplyVO">
		INSERT INTO COMMUNITY_REPLY (
		REPLY_ID, POST_ID, MEMBER_ID, CONTENT
		) VALUES (
		COMMUNITY_REPLY_SEQ.NEXTVAL, #{postId}, #{memberId}, #{content}
		)
	</insert>

	<delete id="deleteReply" parameterType="long">
		DELETE FROM COMMUNITY_REPLY WHERE REPLY_ID = #{replyId}
	</delete>
	
	<update id="updateReply" parameterType="kr.spring.community.vo.CommunityReplyVO">
    	UPDATE COMMUNITY_REPLY
    	SET CONTENT = #{content}
    	WHERE REPLY_ID = #{replyId}
	</update>
	
	<update id="updateCommentCount">
	    UPDATE COMMUNITY_POST
	    SET COMMENT_COUNT = NVL(COMMENT_COUNT, 0) + #{amount}
	    WHERE ID = #{postId}
	</update>

</mapper>
