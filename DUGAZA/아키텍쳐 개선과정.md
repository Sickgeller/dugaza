#  Spring Security ë¦¬íŒ©í† ë§

webapp/mainì˜ Spring Security ì˜ˆì œ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ í”„ë¡œì íŠ¸ì— ì ìš©í•œ í–¥ìƒëœ ì¸ì¦/ê¶Œí•œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸ”§ ì£¼ìš” ê°œì„ ì‚¬í•­

### 1. ë‹¤ì¤‘ Security Filter Chain
- **ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜** (`@Order(2)`): ì¼ë°˜ ì›¹ í˜ì´ì§€ ì ‘ê·¼ ì œì–´
- **REST API** (`@Order(1)`): API ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì œì–´

### 2. í–¥ìƒëœ ì‚¬ìš©ì ì¸ì¦
- `CustomUserDetails`: í†µí•©ëœ ì‚¬ìš©ì ì •ë³´ ê´€ë¦¬ (Member + Seller)
- `EnhancedUserDetailsService`: ê°œì„ ëœ ì‚¬ìš©ì ì¡°íšŒ ì„œë¹„ìŠ¤
- ë‹¤ì¤‘ ì—­í•  ì§€ì› (ê¸°ë³¸ ì—­í•  + ì¶”ê°€ ì—­í• )

### 3. í–¥ìƒëœ Authentication Provider
- `DaoAuthenticationProvider`: Spring Security ê¸°ë³¸ Provider ì‚¬ìš©
- ìˆœí™˜ì°¸ì¡° ë°©ì§€ë¥¼ ìœ„í•´ ì»¤ìŠ¤í…€ Provider ëŒ€ì‹  ê¸°ë³¸ Provider ì‚¬ìš©
- `EnhancedUserDetailsService`ì™€ í†µí•©í•˜ì—¬ í–¥ìƒëœ ì¸ì¦ ì œê³µ

### 4. í–¥ìƒëœ ì¸ì¦ í•¸ë“¤ëŸ¬
- `EnhancedSuccessHandler`: ì—­í•  ê¸°ë°˜ ë¦¬ë‹¤ì´ë ‰íŠ¸
- `CustomFailureHandler`: ìƒì„¸í•œ ì˜¤ë¥˜ ë©”ì‹œì§€

## ğŸ“ ìƒˆë¡œ ì¶”ê°€ëœ íŒŒì¼ë“¤

### VO (Value Objects)
- `RoleVO`: ì—­í•  ì •ë³´
- `ResourceVO`: ë¦¬ì†ŒìŠ¤ ì •ë³´
- `MemberVO`: ë‹¤ì¤‘ ì—­í•  ì§€ì› í™•ì¥

### Security Components
- `CustomUserDetails`: í†µí•© ì‚¬ìš©ì ì •ë³´
- `EnhancedUserDetailsService`: í–¥ìƒëœ ì‚¬ìš©ì ì„œë¹„ìŠ¤
- `EnhancedSuccessHandler`: ì„±ê³µ í•¸ë“¤ëŸ¬
- `CustomFailureHandler`: ì‹¤íŒ¨ í•¸ë“¤ëŸ¬
- `DaoAuthenticationProvider`: ìˆœí™˜ì°¸ì¡° ë°©ì§€ë¥¼ ìœ„í•œ ê¸°ë³¸ Provider ì‚¬ìš©

### Configuration
- `EnhancedSecurityConfig`: ë‹¤ì¤‘ í•„í„°ì²´ì¸ ì„¤ì •

### Controller
- `EnhancedAuthController`: ì¸ì¦ ê´€ë ¨ API

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### ìƒˆë¡œìš´ í…Œì´ë¸”
1. **ROLE**: ì‹œìŠ¤í…œ ì—­í•  ì •ì˜
2. **RESOURCES**: ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ ì •ì˜
3. **ACCOUNT_ROLES**: ì‚¬ìš©ì-ì—­í•  ë§¤í•‘
4. **ROLE_RESOURCES**: ì—­í• -ë¦¬ì†ŒìŠ¤ ë§¤í•‘

### ì‹¤í–‰ ë°©ë²•
```sql
-- í…Œì´ë¸” ìƒì„±
@src/main/resources/static/sql/enhanced_security_tables.sql
```

## ğŸ” ë³´ì•ˆ êµ¬ì¡°

### ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì ‘ê·¼ ì œì–´
```
/ â†’ ëª¨ë“  ì‚¬ìš©ì ì ‘ê·¼ ê°€ëŠ¥
/member/login â†’ ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥
/seller/** â†’ ROLE_SELLER í•„ìš”
/admin/** â†’ ROLE_ADMIN í•„ìš”
ê¸°íƒ€ â†’ ì¸ì¦ í•„ìš”
```

### REST API ì ‘ê·¼ ì œì–´
```
/api/public/** â†’ ëª¨ë“  ì‚¬ìš©ì ì ‘ê·¼ ê°€ëŠ¥
/api/user/** â†’ ROLE_USER í•„ìš”
/api/seller/** â†’ ROLE_SELLER í•„ìš”
/api/admin/** â†’ ROLE_ADMIN í•„ìš”
```

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. ê¸°ì¡´ SecurityConfig ë¹„í™œì„±í™”
ê¸°ì¡´ `SecurityConfig.java`ë¥¼ ì£¼ì„ ì²˜ë¦¬í•˜ê±°ë‚˜ `@Configuration` ì œê±°

### 2. ìƒˆë¡œìš´ ì„¤ì • í™œì„±í™”
`EnhancedSecurityConfig`ê°€ ìë™ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤.

### 3. ì‚¬ìš©ì ì—­í•  í™•ì¸
```java
@GetMapping("/example")
public String example(Authentication auth) {
    CustomUserDetails user = (CustomUserDetails) auth.getPrincipal();
    
    if (user.isSeller()) {
        // íŒë§¤ì ë¡œì§
    } else if (user.isMember()) {
        // ì¼ë°˜ íšŒì› ë¡œì§
    }
    
    return "example";
}
```

### 4. API ì—”ë“œí¬ì¸íŠ¸
- `GET /auth/user-info`: í˜„ì¬ ì‚¬ìš©ì ì •ë³´
- `GET /auth/status`: ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
- `GET /auth/dashboard`: ì—­í• ë³„ ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸

## ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### 1ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
```sql
-- 1. ìƒˆë¡œìš´ í…Œì´ë¸” ìƒì„±
@src/main/resources/static/sql/enhanced_security_tables.sql

-- 2. ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
@src/main/resources/static/sql/migration_script.sql
```

### 2ë‹¨ê³„: ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜
âœ… **ì™„ë£Œëœ íŒŒì¼ë“¤:**
- `SecurityConfig.java` â†’ `EnhancedSecurityConfig.java`
- `UserSecurityService.java` â†’ `EnhancedUserDetailsService.java`
- `PrincipalDetails.java` â†’ `CustomUserDetails.java`
- `AuthController.java` â†’ ìƒˆë¡œìš´ ì‹œìŠ¤í…œìœ¼ë¡œ ì—…ë°ì´íŠ¸
- `MemberUserController.java` â†’ ìƒˆë¡œìš´ ì‹œìŠ¤í…œìœ¼ë¡œ ì—…ë°ì´íŠ¸
- `SellerController.java` â†’ ìƒˆë¡œìš´ ì‹œìŠ¤í…œìœ¼ë¡œ ì—…ë°ì´íŠ¸

### 3ë‹¨ê³„: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
1. âœ… ê¸°ì¡´ `@Configuration` ë¹„í™œì„±í™”ë¨
2. âœ… ìƒˆë¡œìš´ `EnhancedSecurityConfig` í™œì„±í™”ë¨
3. âœ… Authentication Provider ì—°ê²°ë¨

### ì½”ë“œ ë³€ê²½ ì˜ˆì‹œ

#### Controllerì—ì„œ ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼
```java
// Before (ê¸°ì¡´)
@GetMapping("/example")
public String example(@AuthenticationPrincipal PrincipalDetails principal) {
    MemberVO member = principal.getMemberVO();
    return "example";
}

// After (ë§ˆì´ê·¸ë ˆì´ì…˜ í›„)
@GetMapping("/example")
public String example(@AuthenticationPrincipal CustomUserDetails principal) {
    MemberVO member = principal.getMember();
    // ì¶”ê°€ ê¸°ëŠ¥
    boolean isSeller = principal.isSeller();
    Collection<? extends GrantedAuthority> authorities = principal.getAuthorities();
    return "example";
}
```

#### REST APIì—ì„œ ì‚¬ìš©ì ì •ë³´ ì ‘ê·¼
```java
// Before
Authentication auth = SecurityContextHolder.getContext().getAuthentication();
String username = auth.getName();

// After
CustomUserDetails userDetails = (CustomUserDetails) auth.getPrincipal();
String username = userDetails.getUsername();
String realName = userDetails.getRealName();
Long userId = userDetails.getUserId();
```

## ğŸ”„ ê¸°ì¡´ ê¸°ëŠ¥ê³¼ì˜ í˜¸í™˜ì„±

- ê¸°ì¡´ `MemberVO`, `SellerVO` êµ¬ì¡° ìœ ì§€
- MyBatis ë§¤í¼ ì¸í„°í˜ì´ìŠ¤ í™•ì¥ (ê¸°ì¡´ ë©”ì„œë“œ ìœ ì§€)
- ê¸°ì¡´ URL íŒ¨í„´ ìœ ì§€

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. âœ… **ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…**: ìƒˆ í…Œì´ë¸” ìƒì„± ì „ ë°±ì—… ê¶Œì¥
2. âœ… **ì„¤ì • ì¶©ëŒ**: ê¸°ì¡´ SecurityConfig ë¹„í™œì„±í™” ì™„ë£Œ
3. âœ… **ì—­í•  ë§¤í•‘**: migration_script.sqlë¡œ ìë™ ë§¤í•‘ ì²˜ë¦¬
4. âœ… **ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜**: ì£¼ìš” ì»¨íŠ¸ë¡¤ëŸ¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ
5. âœ… **ìˆœí™˜ì°¸ì¡° í•´ê²°**: DaoAuthenticationProvider ì‚¬ìš©ìœ¼ë¡œ í•´ê²°

### í…ŒìŠ¤íŠ¸ ê³„ì •
- **ê´€ë¦¬ì**: `admin` / `admin123`
- **ì¼ë°˜ì‚¬ìš©ì**: `testuser` / `user123`

## ğŸ”§ ì¶”ê°€ ê°œì„  ê°€ëŠ¥ì‚¬í•­

1. **ë™ì  ê¶Œí•œ ê´€ë¦¬**: ëŸ°íƒ€ì„ì— ê¶Œí•œ ë³€ê²½
2. **ê³„ì¸µì  ì—­í• **: ì—­í•  ìƒì† êµ¬ì¡°
3. **ì„¸ì…˜ ê´€ë¦¬**: ë™ì‹œ ë¡œê·¸ì¸ ì œí•œ
4. **ê°ì‚¬ ë¡œê·¸**: ì¸ì¦/ê¶Œí•œ ë³€ê²½ ì´ë ¥

## ğŸš€ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ë°©ë²•

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```bash
# Oracle DBì—ì„œ ì‹¤í–‰
sqlplus user/password@database

-- 1ë‹¨ê³„: ìƒˆ í…Œì´ë¸” ìƒì„±
@src/main/resources/static/sql/enhanced_security_tables.sql

-- 2ë‹¨ê³„: ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
@src/main/resources/static/sql/migration_script.sql
```

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘
- âœ… ê¸°ì¡´ ì„¤ì •ì´ ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”ë¨
- âœ… ìƒˆë¡œìš´ ì„¤ì •ì´ ìë™ìœ¼ë¡œ í™œì„±í™”ë¨

### 3. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
1. ë¡œê·¸ì¸í¼: `/member/login` âœ…
2. REST API: `/auth/member-login` âœ…
3. ì‚¬ìš©ì ì •ë³´: `/auth/user-info` (ë¯¸êµ¬í˜„)
4. ê¶Œí•œë³„ í˜ì´ì§€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸  (ë¯¸êµ¬í˜„)

---
