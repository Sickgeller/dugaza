<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout_basic}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ™ì†Œ ì˜ˆì•½ - ë“œê°€ìë‹·ì»´</title>
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
    <link rel="stylesheet" th:href="@{/assets/css/accommodation-detail.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .reservation-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            margin-top: 70px;
        }
        
        .reservation-header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .reservation-header h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .reservation-header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.1rem;
        }
        
        .reservation-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }
        
        .reservation-form {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .form-section {
            margin-bottom: 35px;
            padding: 25px;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            background: #fafbfc;
        }
        
        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-section h3 i {
            color: #3498db;
            font-size: 1.2rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
            font-size: 0.95rem;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .date-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* ê°ì‹¤ íƒ€ì… ë²„íŠ¼ ê°œì„  */
        .room-type-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .room-type-btn {
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            background: white;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .room-type-btn:hover {
            border-color: #3498db;
            color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.15);
        }
        
        .room-type-btn.active {
            background: #3498db;
            border-color: #3498db;
            color: white;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .room-type-btn .room-count {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .room-type-btn:not(.active) .room-count {
            background: #f8f9fa;
            color: #6c757d;
        }
        
        /* ê°ì‹¤ ì˜µì…˜ ê°œì„  */
        .room-options {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
            background: white;
        }
        
        .room-option {
            padding: 20px;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .room-option:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }
        
        .room-option.selected {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.1);
        }
        
        .room-option.unavailable {
            opacity: 0.6;
            background-color: #f8f9fa;
            cursor: not-allowed;
            position: relative;
        }
        
        .room-option.unavailable::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.05);
            z-index: 1;
            pointer-events: none;
        }
        
        .room-option.unavailable .room-info {
            pointer-events: none;
        }
        
        .room-option.unavailable:hover {
            background-color: #f8f9fa;
            transform: none;
        }
        
        .room-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .room-details h4 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .room-details p {
            margin: 0 0 5px 0;
            color: #6c757d;
            font-size: 14px;
        }
        
        .room-price {
            text-align: right;
        }
        
        .room-price .price {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .room-price .per-night {
            font-size: 12px;
            color: #95a5a6;
        }
        
        .availability-status {
            position: absolute;
            top: 10px;
            right: 15px;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .availability-status.available {
            background: #d4edda;
            color: #155724;
        }
        
        .availability-status.unavailable {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* ì˜ˆì•½ ìš”ì•½ ê°œì„  */
        .reservation-summary {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        .summary-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .summary-header h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }
        
        .house-info {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
        }
        
        .house-image {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
        }
        
        .house-details h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .house-details p {
            margin: 0;
            color: #6c757d;
            font-size: 14px;
        }
        
        .price-breakdown {
            margin-bottom: 25px;
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .price-item.total {
            border-top: 2px solid #3498db;
            padding-top: 15px;
            font-weight: bold;
            font-size: 1.2rem;
            color: #2c3e50;
        }
        
        .reservation-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .reservation-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .reservation-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* íŠ¹ë³„ ìš”ì²­ì‚¬í•­ ê°œì„  */
        .special-requests textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            resize: vertical;
            min-height: 100px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .special-requests textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            margin: 3% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: 1px solid rgba(255,255,255,0.2);
            overflow: hidden;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-60px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .modal-header h3::before {
            content: 'âœ“';
            background: rgba(255,255,255,0.2);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            color: white;
            font-size: 24px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .close-modal:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
            background: white;
        }
        
        .modal-body p {
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
            line-height: 1.6;
        }
        
        #confirmDetails {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
            margin: 20px 0;
        }
        
        #confirmDetails p {
            margin: 12px 0;
            color: #34495e;
            font-size: 0.95rem;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        #confirmDetails p:last-child {
            border-bottom: none;
        }
        
        #confirmDetails strong {
            color: #2c3e50;
            font-weight: 600;
            min-width: 100px;
        }
        
        #confirmDetails .price-highlight {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .modal-footer {
            padding: 25px 30px;
            background: #f8f9fa;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            border-top: 1px solid #e9ecef;
        }
        
        .btn-cancel, .btn-confirm {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-cancel {
            background: #6c757d;
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-cancel:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }
        
        .btn-confirm {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-confirm:hover {
            background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .btn-confirm::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-confirm:hover::before {
            left: 100%;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .reservation-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .date-inputs {
                grid-template-columns: 1fr;
            }
            
            .room-type-buttons {
                justify-content: center;
            }
            
            .room-type-btn {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
            
            .reservation-summary {
                position: static;
                margin-top: 20px;
            }
            
            .reservation-header h1 {
                font-size: 2rem;
            }
        }
        
        /* ì„ íƒëœ ê°ì‹¤ ì •ë³´ ìŠ¤íƒ€ì¼ */
        .selected-room-info {
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 15px;
            border-left: 4px solid #3498db;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.1);
        }
        
        .selected-room-info h4 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .selected-room-info h4::before {
            content: 'ğŸ ';
            font-size: 1.2rem;
        }
        
        .selected-room-info p {
            margin: 10px 0;
            color: #34495e;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .selected-room-info strong {
            color: #2c3e50;
            font-weight: 600;
            min-width: 80px;
        }
    </style>
</head>
<body>
<main layout:fragment="content">
    <div class="reservation-container">
        <div class="reservation-header">
            <h1>ìˆ™ì†Œ ì˜ˆì•½</h1>
            <p>í¸ì•ˆí•œ ìˆ™ë°•ì„ ìœ„í•œ ì˜ˆì•½ì„ ì§„í–‰í•´ì£¼ì„¸ìš”</p>
        </div>
        
        <div class="reservation-content">
            <!-- ì˜ˆì•½ í¼ -->
            <div class="reservation-form">
                <form id="reservationForm" th:action="@{/reservation/house/book}" method="post">
                    <input type="hidden" name="houseId" th:value="${contentId}" />
                    <input type="hidden" name="roomId" id="selectedRoomId" />
                    <input type="hidden" name="reservationStart" id="reservationStart" />
                    <input type="hidden" name="reservationEnd" id="reservationEnd" />
                    <input type="hidden" name="reservationCount" id="reservationCount" />
                    <input type="hidden" name="price" id="reservationPrice" />
                    <input type="hidden" name="status" value="0" />
                    
                    <!-- ë‚ ì§œ ì„ íƒ -->
                    <div class="form-section">
                        <h3><i class="fas fa-calendar"></i> ë‚ ì§œ ì„ íƒ</h3>
                        <div class="date-inputs">
                            <div class="form-group">
                                <label for="checkInDate">ì²´í¬ì¸</label>
                                <input type="date" id="checkInDate" name="checkInDate" required>
                            </div>
                            <div class="form-group">
                                <label for="checkOutDate">ì²´í¬ì•„ì›ƒ</label>
                                <input type="date" id="checkOutDate" name="checkOutDate" required>
                            </div>
                        </div>
                    </div>
                    
                 
                    
                    <!-- ê°ì‹¤ ì„ íƒ -->
                    <div class="form-section">
                        <h3><i class="fas fa-bed"></i> ê°ì‹¤ ì„ íƒ</h3>
                        
                        <!-- ê°ì‹¤ íƒ€ì… ì„ íƒ -->
                        <div class="room-type-selection" style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #555;">ê°ì‹¤ íƒ€ì… ì„ íƒ</label>
                            <div class="room-type-buttons" id="roomTypeButtons">
                                <!-- ê°ì‹¤ íƒ€ì… ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </div>
                        </div>
                        
                        <!-- ì„ íƒëœ íƒ€ì…ì˜ ê°ì‹¤ ëª©ë¡ -->
                        <div class="room-options" id="roomOptions">
                            <!-- ê°ì‹¤ì´ ì—†ì„ ê²½ìš° -->
                            <div th:if="${#lists.isEmpty(roomList)}" class="no-rooms">
                                <p>ë“±ë¡ëœ ê°ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                            
                            <!-- ê¸°ì¡´ ê°ì‹¤ ëª©ë¡ (JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì²˜ë¦¬ë¨) -->
                            <div class="room-option" th:each="room : ${roomList}" 
                                 th:data-room-id="${room.roomId}" 
                                 th:data-price="${room.price}"
                                 th:data-room-name="${room.roomName}"
                                 th:data-room-type="${room.roomType}"
                                 th:data-room-size="${room.roomSize}"
                                 th:data-min-capacity="${room.minimumCapacity}"
                                 th:data-max-capacity="${room.maximumCapacity}"
                                 th:data-bed-info="${room.bedInfo}"
                                 th:data-description="${room.description}"
                                 style="display: none;">
                            </div>
                        </div>
                    </div>

                       <!-- ì¸ì› ì„ íƒ -->
                    <div class="form-section">
                        <h3><i class="fas fa-users"></i> ì¸ì› ì„ íƒ</h3>
                        <div class="form-group">
                            <label for="guestCount">íˆ¬ìˆ™ ì¸ì›</label>
                            <select id="guestCount" name="guestCount" required>
                                <option value="">ê°ì‹¤ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</option>
                            </select>
                            <small class="capacity-info" id="capacityInfo" style="display: none; color: #666; margin-top: 5px;">
                                <!-- ìˆ˜ìš© ì¸ì› ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë¨ -->
                            </small>
                        </div>
                    </div>
                    
                    <!-- íˆ¬ìˆ™ê° ì •ë³´ -->
                    <!-- <div class="form-section">
                        <h3><i class="fas fa-user"></i> íˆ¬ìˆ™ê° ì •ë³´</h3>
                        <div class="guest-info">
                            <h4>ëŒ€í‘œ íˆ¬ìˆ™ê° ì •ë³´</h4>
                            <div class="guest-fields">
                                <div class="form-group">
                                    <label for="guestName">ì´ë¦„</label>
                                    <input type="text" id="guestName" name="guestName" required>
                                </div>
                                <div class="form-group">
                                    <label for="guestPhone">ì—°ë½ì²˜</label>
                                    <input type="tel" id="guestPhone" name="guestPhone" required>
                                </div>
                                <div class="form-group">
                                    <label for="guestEmail">ì´ë©”ì¼</label>
                                    <input type="email" id="guestEmail" name="guestEmail" required>
                                </div>
                                <div class="form-group">
                                    <label for="guestIdCard">ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</label>
                                    <input type="text" id="guestIdCard" name="guestIdCard" placeholder="000000-0000000" required>
                                </div>
                            </div>
                        </div>
                    </div>
                     -->
                    <!-- íŠ¹ë³„ ìš”ì²­ì‚¬í•­ -->
                    <div class="form-section">
                        <h3><i class="fas fa-comment"></i> íŠ¹ë³„ ìš”ì²­ì‚¬í•­</h3>
                        <div class="special-requests">
                            <textarea name="specialRequests" placeholder="íŠ¹ë³„í•œ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì„ íƒì‚¬í•­)"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- ì˜ˆì•½ ìš”ì•½ -->
            <div class="reservation-summary">
                <div class="summary-header">
                    <h3>ì˜ˆì•½ ìš”ì•½</h3>
                </div>
                
                <!-- ìˆ™ì†Œ ì •ë³´ -->
                <div class="house-info">
                    <img th:src="${houseInfo.firstImage}" alt="ìˆ™ì†Œ ì´ë¯¸ì§€" class="house-image">
                    <div class="house-details">
                        <h4 th:text="${houseInfo.title}">ìˆ™ì†Œëª…</h4>
                        <p th:text="${houseInfo.addr1}">ì£¼ì†Œ</p>
                    </div>
                </div>
                
                <!-- ê°€ê²© ë‚´ì—­ -->
                <div class="price-breakdown">
                    <div class="price-item">
                        <span>ê°ì‹¤ ìš”ê¸ˆ</span>
                        <span id="roomPrice">-</span>
                    </div>
                    <div class="price-item">
                        <span>ìˆ™ë°•ì¼ìˆ˜</span>
                        <span id="nights">-</span>
                    </div>
                    <div class="price-item">
                        <span>ì„¸ê¸ˆ ë° ìˆ˜ìˆ˜ë£Œ</span>
                        <span id="taxFee">-</span>
                    </div>
                    <div class="price-item total">
                        <span>ì´ ê²°ì œê¸ˆì•¡</span>
                        <span id="totalPrice">-</span>
                    </div>
                </div>
                
                <!-- ì˜ˆì•½ ë²„íŠ¼ -->
                <button type="button" id="reservationBtn" class="reservation-btn" disabled>
                    ì˜ˆì•½í•˜ê¸°
                </button>
                
                <!-- ì˜ˆì•½ ì•ˆë‚´ -->
                <div style="margin-top: 20px; font-size: 12px; color: #666;">
                    <p><i class="fas fa-info-circle"></i> ì˜ˆì•½ ì™„ë£Œ í›„ ê²°ì œê°€ ì§„í–‰ë©ë‹ˆë‹¤.</p>
                    <p><i class="fas fa-clock"></i> ì²´í¬ì¸ 3ì¼ ì „ê¹Œì§€ ë¬´ë£Œ ì·¨ì†Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì˜ˆì•½ í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì˜ˆì•½ í™•ì¸</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p>ì•„ë˜ ë‚´ìš©ìœ¼ë¡œ ì˜ˆì•½ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <div id="confirmDetails"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">
                    <i class="fas fa-times"></i> ì·¨ì†Œ
                </button>
                <button type="button" class="btn-confirm">
                    <i class="fas fa-check"></i> ì˜ˆì•½ í™•ì •
                </button>
            </div>
        </div>
    </div>
    
    <script th:src="@{/assets/js/jquery-3.7.1.min.js}"></script>
    <script th:inline="javascript">
        // Thymeleafì—ì„œ houseInfo ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const houseInfo = /*[[${houseInfo}]]*/ {};
        
        $(document).ready(function() {
            const checkInDate = $('#checkInDate');
            const checkOutDate = $('#checkOutDate');
            const guestCount = $('#guestCount');
            const roomOptions = $('#roomOptions');
            const roomTypeButtons = $('#roomTypeButtons');
            const reservationBtn = $('#reservationBtn');
            
            let selectedRoom = null;
            let roomData = [];
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ê°ì‹¤ ë°ì´í„° ì´ˆê¸°í™”
            function initializeRoomData() {
                $('.room-option').each(function() {
                    const room = {
                        roomId: $(this).data('room-id'),
                        roomName: $(this).data('room-name'),
                        roomType: $(this).data('room-type'),
                        price: $(this).data('price'),
                        roomSize: $(this).data('room-size'),
                        minimumCapacity: $(this).data('min-capacity') || 1,
                        maximumCapacity: $(this).data('max-capacity'),
                        bedInfo: $(this).data('bed-info'),
                        description: $(this).data('description')
                    };
                    roomData.push(room);
                });
                
                // ê°ì‹¤ íƒ€ì…ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ë²„íŠ¼ ìƒì„±
                const roomTypes = [...new Set(roomData.map(room => room.roomType))];
                
                roomTypes.forEach(type => {
                    const roomsOfType = roomData.filter(room => room.roomType === type);
                    const button = $(`
                        <button type="button" class="room-type-btn" data-type="${type}">
                            <i class="fas fa-bed"></i>
                            <span>${type}</span>
                            <span class="room-count">${roomsOfType.length}</span>
                        </button>
                    `);
                    roomTypeButtons.append(button);
                });
                
                // ì²« ë²ˆì§¸ íƒ€ì… ìë™ ì„ íƒ
                if (roomTypes.length > 0) {
                    $('.room-type-btn').first().addClass('active');
                    updateRoomList(roomTypes[0]);
                }
            }
            
            // ê°ì‹¤ íƒ€ì… ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            $(document).on('click', '.room-type-btn', function() {
                if ($(this).hasClass('disabled')) return;
                
                $('.room-type-btn').removeClass('active');
                $(this).addClass('active');
                
                const selectedType = $(this).data('type');
                updateRoomList(selectedType);
                
                // ì„ íƒëœ ê°ì‹¤ ì´ˆê¸°í™”
                selectedRoom = null;
                $('.room-option').removeClass('selected');
                updateGuestCountOptions();
                calculatePrice();
            });
            
            // ê°ì‹¤ ëª©ë¡ ì—…ë°ì´íŠ¸
            function updateRoomList(type) {
                roomOptions.empty();
                
                const roomsOfType = roomData.filter(room => room.roomType === type);
                
                if (roomsOfType.length === 0) {
                    roomOptions.html('<div class="no-rooms"><p>í•´ë‹¹ íƒ€ì…ì˜ ê°ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>');
                    return;
                }
                
                // ê°ì‹¤ ê·¸ë£¹ í—¤ë”
                const groupHeader = $(`
                    <div class="room-group-header">
                        <h4>${type}</h4>
                        <p>${roomsOfType.length}ê°œì˜ ê°ì‹¤ ì¤‘ ì„ íƒí•˜ì„¸ìš”</p>
                    </div>
                `);
                roomOptions.append(groupHeader);
                
                // ê°ì‹¤ ëª©ë¡
                const roomGroup = $('<div class="room-group active"></div>');
                
                roomsOfType.forEach(room => {
                    const roomElement = $(`
                        <div class="room-option" 
                             data-room-id="${room.roomId}" 
                             data-price="${room.price}"
                             data-room-name="${room.roomName}"
                             data-room-type="${room.roomType}"
                             data-room-size="${room.roomSize}"
                             data-min-capacity="${room.minimumCapacity}"
                             data-max-capacity="${room.maximumCapacity}"
                             data-bed-info="${room.bedInfo}"
                             data-description="${room.description}">
                            <div class="room-info">
                                <div class="room-details">
                                    <h4>${room.roomName}</h4>
                                    <p>ìµœì†Œ ${room.minimumCapacity}ëª… ~ ìµœëŒ€ ${room.maximumCapacity}ëª… / ${room.roomSize}ã¡</p>
                                    <p>${room.bedInfo}</p>
                                    ${room.description ? `<p>${room.description}</p>` : ''}
                                </div>
                                <div class="room-price">
                                    <div class="price">${room.price.toLocaleString()}ì›</div>
                                    <div class="per-night">1ë°• ê¸°ì¤€</div>
                                </div>
                            </div>
                        </div>
                    `);
                    roomGroup.append(roomElement);
                });
                
                roomOptions.append(roomGroup);
            }
            
            // ìµœì†Œ ì²´í¬ì¸ ë‚ ì§œë¥¼ ì˜¤ëŠ˜ë¡œ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            checkInDate.attr('min', today);
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ê°ì‹¤ ë°ì´í„° ì´ˆê¸°í™”
            initializeRoomData();
            
            // ë‚ ì§œ ë³€ê²½ ì‹œ ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
            checkInDate.on('change', function() {
                if (checkInDate.val() && checkOutDate.val() && guestCount.val()) {
                    checkRoomAvailability();
                }
                calculatePrice();
            });
            
            checkOutDate.on('change', function() {
                if (checkInDate.val() && checkOutDate.val() && guestCount.val()) {
                    checkRoomAvailability();
                }
                calculatePrice();
            });
            
            // ì¸ì› ë³€ê²½ ì‹œ ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
            guestCount.on('change', function() {
                if (checkInDate.val() && checkOutDate.val() && guestCount.val()) {
                    checkRoomAvailability();
                }
                calculatePrice();
            });
            
            // ê°ì‹¤ ì„ íƒ ì´ë²¤íŠ¸
            $(document).on('click', '.room-option', function() {
                // ì˜ˆì•½ ë¶ˆê°€ëŠ¥í•œ ê°ì‹¤ì€ ì„ íƒ ë¶ˆê°€
                if ($(this).hasClass('unavailable')) {
                    alert('í•´ë‹¹ ê°ì‹¤ì€ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê°ì‹¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
                
                // ê¸°ì¡´ ì„ íƒ í•´ì œ
                $('.room-option').removeClass('selected');
                
                // í˜„ì¬ ê°ì‹¤ ì„ íƒ
                $(this).addClass('selected');
                
                // ì„ íƒëœ ê°ì‹¤ ì •ë³´ ì €ì¥
                selectedRoom = {
                    roomId: $(this).data('room-id'),
                    roomName: $(this).data('room-name'),
                    roomType: $(this).data('room-type'),
                    price: $(this).data('price'),
                    roomSize: $(this).data('room-size'),
                    minimumCapacity: $(this).data('min-capacity') || 1,
                    maximumCapacity: $(this).data('max-capacity'),
                    bedInfo: $(this).data('bed-info'),
                    description: $(this).data('description')
                };
                
                // ì¸ì› ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
                updateGuestCountOptions();
                
                calculatePrice();
                updateRoomInfo();
            });
            
            // ì¸ì› ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
            function updateGuestCountOptions() {
                if (!selectedRoom) {
                    guestCount.html('<option value="">ê°ì‹¤ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</option>');
                    $('#capacityInfo').hide();
                    return;
                }
                
                const minCapacity = selectedRoom.minimumCapacity;
                const maxCapacity = selectedRoom.maximumCapacity;
                
                // ê¸°ì¡´ ì˜µì…˜ ì œê±°
                guestCount.empty();
                
                // ê¸°ë³¸ ì˜µì…˜ ì¶”ê°€
                guestCount.append('<option value="">ì¸ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>');
                
                // ìµœì†Œ ì¸ì›ë¶€í„° ìµœëŒ€ ì¸ì›ê¹Œì§€ ì˜µì…˜ ìƒì„±
                for (let i = minCapacity; i <= maxCapacity; i++) {
                    guestCount.append(`<option value="${i}">${i}ëª…</option>`);
                }
                
                // ìˆ˜ìš© ì¸ì› ì •ë³´ í‘œì‹œ
                const capacityInfo = `ìˆ˜ìš© ê°€ëŠ¥ ì¸ì›: ${minCapacity}ëª… ~ ${maxCapacity}ëª…`;
                $('#capacityInfo').text(capacityInfo).show();
                
                // ê¸°ì¡´ ì„ íƒê°’ ì´ˆê¸°í™”
                guestCount.val('');
            }
            
            // ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
            function checkRoomAvailability() {
                const contentId = $('input[name="houseId"]').val();
                const checkIn = checkInDate.val();
                const checkOut = checkOutDate.val();
                const guests = guestCount.val();
                
                if (!contentId || !checkIn || !checkOut || !guests) {
                    return;
                }
                
                // ëª¨ë“  ê°ì‹¤ì— ë¡œë”© í‘œì‹œ
                $('.room-option').addClass('checking');
                
                // AJAXë¡œ ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ í™•ì¸
                $.ajax({
                    url: '/api/rooms/available',
                    method: 'GET',
                    data: {
                        contentId: contentId,
                        checkIn: checkIn,
                        checkOut: checkOut,
                        guestCount: guests
                    },
                    success: function(response) {
                        if (response.success) {
                            const availableRoomIds = response.rooms.map(room => room.roomId);
                            
                            // ê° ê°ì‹¤ì˜ ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ ì—…ë°ì´íŠ¸
                            $('.room-option').each(function() {
                                const roomId = $(this).data('room-id');
                                const isAvailable = availableRoomIds.includes(roomId);
                                
                                $(this).removeClass('checking');
                                
                                if (isAvailable) {
                                    $(this).removeClass('unavailable').addClass('available');
                                    $(this).find('.availability-status').remove();
                                    $(this).append('<div class="availability-status available">ì˜ˆì•½ ê°€ëŠ¥</div>');
                                } else {
                                    $(this).removeClass('available').addClass('unavailable');
                                    $(this).find('.availability-status').remove();
                                    $(this).append('<div class="availability-status unavailable">ì˜ˆì•½ ë¶ˆê°€</div>');
                                }
                            });
                            
                            // ê°ì‹¤ íƒ€ì… ë²„íŠ¼ì˜ ì˜ˆì•½ ê°€ëŠ¥ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                            updateRoomTypeAvailability(availableRoomIds);
                        }
                    },
                    error: function(xhr, status, error) {
                        $('.room-option').removeClass('checking');
                        alert('ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
            
            // ê°ì‹¤ íƒ€ì…ë³„ ì˜ˆì•½ ê°€ëŠ¥ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            function updateRoomTypeAvailability(availableRoomIds) {
                $('.room-type-btn').each(function() {
                    const type = $(this).data('type');
                    const roomsOfType = roomData.filter(room => room.roomType === type);
                    const availableCount = roomsOfType.filter(room => 
                        availableRoomIds.includes(room.roomId)
                    ).length;
                    
                    const countElement = $(this).find('.room-count');
                    countElement.text(`${availableCount}/${roomsOfType.length}`);
                    
                    // ì˜ˆì•½ ê°€ëŠ¥í•œ ê°ì‹¤ì´ ì—†ìœ¼ë©´ ë²„íŠ¼ ë¹„í™œì„±í™”
                    if (availableCount === 0) {
                        $(this).addClass('disabled').prop('disabled', true);
                    } else {
                        $(this).removeClass('disabled').prop('disabled', false);
                    }
                });
            }
            
            // ê°€ê²© ê³„ì‚°
            function calculatePrice() {
                const selectedRoom = $('.room-option.selected');
                if (selectedRoom.length === 0) {
                    $('#roomPrice').text('-');
                    $('#nights').text('-');
                    $('#taxFee').text('-');
                    $('#totalPrice').text('-');
                    reservationBtn.prop('disabled', true);
                    return;
                }
                
                const roomPrice = parseInt(selectedRoom.data('price'));
                const nights = calculateNights();
                const totalRoomPrice = roomPrice * nights;
                const taxFee = Math.round(totalRoomPrice * 0.1); // 10% ì„¸ê¸ˆ
                const totalPrice = totalRoomPrice + taxFee;
                
                $('#roomPrice').text(totalRoomPrice.toLocaleString() + 'ì›');
                $('#nights').text(nights + 'ë°•');
                $('#taxFee').text(taxFee.toLocaleString() + 'ì›');
                $('#totalPrice').text(totalPrice.toLocaleString() + 'ì›');
                
                reservationBtn.prop('disabled', false);
            }
            
            // ì„ íƒëœ ê°ì‹¤ ì •ë³´ ì—…ë°ì´íŠ¸
            function updateRoomInfo() {
                const selectedRoom = $('.room-option.selected');
                if (selectedRoom.length === 0) {
                    return;
                }
                
                const roomName = selectedRoom.data('room-name');
                const roomSize = selectedRoom.data('room-size');
                const maxCapacity = selectedRoom.data('max-capacity');
                const bedInfo = selectedRoom.data('bed-info');
                const description = selectedRoom.data('description');
                
                // ê¸°ì¡´ ì„ íƒëœ ê°ì‹¤ ì •ë³´ ì œê±°
                $('.selected-room-info').remove();
                
                // ì˜ˆì•½ ìš”ì•½ì— ì„ íƒëœ ê°ì‹¤ ì •ë³´ í‘œì‹œ
                $('.house-info').after(`
                    <div class="selected-room-info">
                        <h4>ì„ íƒëœ ê°ì‹¤</h4>
                        <p><strong>ê°ì‹¤ëª…:</strong> ${roomName}</p>
                        <p><strong>í¬ê¸°:</strong> ${roomSize}ã¡</p>
                        <p><strong>ìµœëŒ€ ì¸ì›:</strong> ${maxCapacity}ëª…</p>
                        <p><strong>ì¹¨ëŒ€:</strong> ${bedInfo}</p>
                        ${description ? `<p><strong>ì„¤ëª…:</strong> ${description}</p>` : ''}
                    </div>
                `);
            }
            
            // ìˆ™ë°• ì¼ìˆ˜ ê³„ì‚°
            function calculateNights() {
                if (!checkInDate.val() || !checkOutDate.val()) return 0;
                
                const checkIn = new Date(checkInDate.val());
                const checkOut = new Date(checkOutDate.val());
                const diffTime = checkOut - checkIn;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                return diffDays;
            }
            
            // ì˜ˆì•½ ë²„íŠ¼ í´ë¦­
            reservationBtn.on('click', function() {
                if (!validateForm()) {
                    return;
                }
                
                showConfirmModal();
            });
            
            // í¼ ê²€ì¦
            function validateForm() {
                if (!checkInDate.val()) {
                    alert('ì²´í¬ì¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
                if (!checkOutDate.val()) {
                    alert('ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
                if (!guestCount.val()) {
                    alert('íˆ¬ìˆ™ ì¸ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
                if ($('.room-option.selected').length === 0) {
                    alert('ê°ì‹¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
                
                // ì„ íƒëœ ì¸ì›ì´ ê°ì‹¤ ìˆ˜ìš© ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
                if (selectedRoom) {
                    const selectedGuestCount = parseInt(guestCount.val());
                    const minCapacity = selectedRoom.minimumCapacity;
                    const maxCapacity = selectedRoom.maximumCapacity;
                    
                    if (selectedGuestCount < minCapacity || selectedGuestCount > maxCapacity) {
                        alert(`ì„ íƒí•˜ì‹  ê°ì‹¤ì€ ${minCapacity}ëª… ~ ${maxCapacity}ëª…ê¹Œì§€ ìˆ˜ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                        return false;
                    }
                }
                return true;
            }
            
            // í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
            function showConfirmModal() {
                const selectedRoom = $('.room-option.selected');
                const roomName = selectedRoom.data('room-name');
                const totalPrice = $('#totalPrice').text();
                const nights = $('#nights').text();
                const guestCount = $('#guestCount').val();
                
                const checkInTime = houseInfo.checkInTime || '15:00';
                const checkOutTime = houseInfo.checkOutTime || '11:00';
                
                const confirmDetails = `
                    <div style="margin: 20px 0;">
                        <p><strong>ìˆ™ì†Œëª…</strong><span>${$('.house-details h4').text()}</span></p>
                        <p><strong>ê°ì‹¤ëª…</strong><span>${roomName}</span></p>
                        <p><strong>ì²´í¬ì¸</strong><span>${checkInDate.val()} ${checkInTime}</span></p>
                        <p><strong>ì²´í¬ì•„ì›ƒ</strong><span>${checkOutDate.val()} ${checkOutTime}</span></p>
                        <p><strong>ìˆ™ë°•ì¼ìˆ˜</strong><span>${nights}</span></p>
                        <p><strong>íˆ¬ìˆ™ ì¸ì›</strong><span>${guestCount}ëª…</span></p>
                        <p><strong>ì´ ê²°ì œê¸ˆì•¡</strong><span class="price-highlight">${totalPrice}</span></p>
                    </div>
                `;
                
                $('#confirmDetails').html(confirmDetails);
                $('#confirmModal').fadeIn(300);
            }
            
            // ëª¨ë‹¬ ë‹«ê¸°
            $('.close-modal, .btn-cancel').on('click', function() {
                $('#confirmModal').fadeOut(300);
            });
            
            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            $(document).on('keydown', function(e) {
                if (e.key === 'Escape' && $('#confirmModal').is(':visible')) {
                    $('#confirmModal').fadeOut(300);
                }
            });
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
            $('#confirmModal').on('click', function(e) {
                if (e.target === this) {
                    $(this).fadeOut(300);
                }
            });
            
            // ì˜ˆì•½ í™•ì •
            $('.btn-confirm').on('click', function() {
                // hidden í•„ë“œë“¤ ì„¤ì •
                const selectedRoom = $('.room-option.selected');
                if (selectedRoom.length > 0) {
                    $('#selectedRoomId').val(selectedRoom.data('room-id'));
                }
                
                // ë‚ ì§œì™€ ì‹œê°„ì„ í•©ì³ì„œ LocalDateTime í˜•ì‹ìœ¼ë¡œ ì„¤ì •
                const checkInDateStr = checkInDate.val();
                const checkOutDateStr = checkOutDate.val();
                const checkInTime = houseInfo.checkInTime || '15:00'; // ê¸°ë³¸ê°’ 15:00
                const checkOutTime = houseInfo.checkOutTime || '11:00'; // ê¸°ë³¸ê°’ 11:00
                
                $('#reservationStart').val(checkInDateStr + 'T' + checkInTime + ':00');
                $('#reservationEnd').val(checkOutDateStr + 'T' + checkOutTime + ':00');
                
                // ì¸ì› ìˆ˜ ì„¤ì •
                $('#reservationCount').val(guestCount.val());
                
                // ê°€ê²© ì„¤ì • (ì„¸ê¸ˆ í¬í•¨)
                const totalPrice = $('#totalPrice').text().replace(/[^\d]/g, '');
                $('#reservationPrice').val(totalPrice);
                
                const formData = new FormData($('#reservationForm')[0]);
                
                $.ajax({
                    url: '/reservation/house/book',
                    method: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        if (response.success) {
                            alert('ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                            window.location.href = '/member/mypage';
                        } else {
                            alert(response.message || 'ì˜ˆì•½ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        }
                    },
                    error: function() {
                        alert('ì˜ˆì•½ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            });
        });
    </script>
</main>
</body>
</html>